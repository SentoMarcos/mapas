<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa de instrumentos de percusi贸n</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="estilos-mapas.css" />
</head>

<body>
  <header class="page-hero">
    <p class="hero-label">Atlas sonoro global</p>
    <h1>Percusi贸n y ritmo</h1>
    <p class="hero-copy">Desde los primeros golpes tribales hasta los sets h铆bridos contempor谩neos, descubre c贸mo la percusi贸n ha marcado el pulso de cada cultura.</p>
  </header>

  <main class="page-content">
    <section class="panel-card timeline-panel">
      <div class="section-heading">
        <span class="section-kicker">Historia viva</span>
        <h2>L铆nea del tiempo de la percusi贸n</h2>
        <p>Explora rituales, guerras, fiestas y estudios que definieron la evoluci贸n de membran贸fonos e idi贸fonos.</p>
      </div>

      <div class="timeline" aria-label="L铆nea del tiempo interactiva">
        <div class="timeline-track">
      <svg class="timeline-curve" viewBox="0 0 1200 400" preserveAspectRatio="none" aria-hidden="true">
        <defs>
          <linearGradient id="timelineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#f4a261" />
            <stop offset="25%" stop-color="#2a9d8f" />
            <stop offset="50%" stop-color="#457b9d" />
            <stop offset="75%" stop-color="#e76f51" />
            <stop offset="100%" stop-color="#9b5de5" />
          </linearGradient>
        </defs>
        <path d="M0,260 C120,60 240,360 360,160 S600,360 720,200 960,360 1080,160 1200,320 1200,220" stroke="url(#timelineGradient)" />
      </svg>

      <div class="timeline-event side-top" style="--pos:3%;" data-progress="0.03">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">100.000 a.C.</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">10.000 a.C.</span>
        </div>
        <div class="periodo era-ancient">
          <h4>Prehistoria sonora</h4>
          <ul>
            <li>Percusi贸n corporal, piedras y troncos como primer lenguaje musical.</li>
            <li>Tambores de piel tensada acompa帽an rituales de caza y fertilidad.</li>
            <li>Golpes repetitivos crean trance colectivo y memoria oral.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-bottom" style="--pos:13%;" data-progress="0.13">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">4000 a.C.</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">1500 d.C.</span>
        </div>
        <div class="periodo era-ancient">
          <h4>Civilizaciones antiguas</h4>
          <ul>
            <li>Mesopotamia, Egipto y Mesoam茅rica documentan tambores, sonajas y bastones.</li>
            <li>Instrumentos vinculados a coronaciones, eclipses y calendarios agr铆colas.</li>
            <li>Los talleres sacerdotales codifican ritmos para cada deidad.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-top" style="--pos:25%;" data-progress="0.25">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">30.000 a.C.</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">Presente</span>
        </div>
        <div class="periodo era-ancient">
          <h4>Chamanismo transcontinental</h4>
          <ul>
            <li>En Asia, Am茅rica y frica el tambor abre portales espirituales.</li>
            <li>Patrones repetitivos inducen trance en sanadores y comunidades.</li>
            <li>Cada pueblo asocia timbres y afinaciones a fuerzas de la naturaleza.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-bottom" style="--pos:37%;" data-progress="0.37">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">3000 a.C.</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">1789 d.C.</span>
        </div>
        <div class="periodo era-medieval">
          <h4>Percusi贸n militar y ceremonial</h4>
          <ul>
            <li>China desarrolla tambores de guerra para coordinar ej茅rcitos.</li>
            <li>frica occidental crea tambores parlantes para transmitir mensajes.</li>
            <li>Europa adopta cajas y bombos en cortes, mientras el Imperio Otomano funda bandas Mehter.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-top" style="--pos:48%;" data-progress="0.48">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">1400 d.C.</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">1820 d.C.</span>
        </div>
        <div class="periodo era-classical">
          <h4>Renacimiento y Clasicismo</h4>
          <ul>
            <li>Panderos, claves y tambores acompa帽an danzas cortesanas.</li>
            <li>Los timbales entran en orquesta y requieren afinaci贸n precisa.</li>
            <li>frica y Asia siguen usando tambores como s铆mbolos de poder estatal.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-bottom" style="--pos:58%;" data-progress="0.58">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">Tradiciones</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">Esc茅nicas</span>
        </div>
        <div class="periodo era-renaissance">
          <h4>Teatro y festividades</h4>
          <ul>
            <li>Grecia y Roma emplean panderos y cr贸talos en teatro y culto.</li>
            <li>Asia impulsa taiko, mridangam y danzas dram谩ticas.</li>
            <li>Juglares europeos usan percusi贸n ligera en ferias y procesiones.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-top" style="--pos:70%;" data-progress="0.70">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">Siglo XVIII</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">Siglo XX</span>
        </div>
        <div class="periodo era-classical">
          <h4>Orquesta y academia</h4>
          <ul>
            <li>Se consolidan secciones de percusi贸n con timbal, caja y platos.</li>
            <li>Siglo XIX ampl铆a inventario orquestal con vibr谩fono, celesta y m谩s.</li>
            <li>Siglo XX abraza percusi贸n experimental y ensembles dedicados.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-bottom" style="--pos:82%;" data-progress="0.82">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">Tradiciones</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">Folcl贸ricas</span>
        </div>
        <div class="periodo era-modern">
          <h4>Folclore afro-ind铆gena</h4>
          <ul>
            <li>frica: djembe, sabar y tambores de agua mantienen lazos comunitarios.</li>
            <li>India: tabla, mridangam y ghatam sostienen la tradici贸n carn谩tica.</li>
            <li>Am茅rica Latina: congas, bong贸s, timbales y caj贸n se globalizan.</li>
          </ul>
        </div>
      </div>

      <div class="timeline-event side-top" style="--pos:92%;" data-progress="0.92">
        <div class="timeline-node" tabindex="0">
          <span class="fecha-superior">Siglo XX</span>
          <span class="timeline-node-dot" aria-hidden="true"></span>
          <span class="fecha-inferior">Siglo XXI</span>
        </div>
        <div class="periodo era-contemporary">
          <h4>Bater铆a y globalizaci贸n</h4>
          <ul>
            <li>Nace la bater铆a moderna entre 1900 y 1930 con pedales y hi-hat.</li>
            <li>Rock, pop, funk y metal expanden t茅cnicas y configuraciones.</li>
            <li>Electr贸nica, samplers y pads h铆bridos permiten fusiones sin fronteras.</li>
          </ul>
        </div>
      </div>
    </div>
      </div>

      <p class="timeline-hint"> Desliza horizontalmente o usa la rueda del rat贸n para recorrer los hitos r铆tmicos.</p>
    </section>

    <section class="panel-card map-panel">
      <div class="section-heading">
        <span class="section-kicker">Geograf铆a</span>
        <h2>Mapa de origen y difusi贸n</h2>
        <p>Localiza los epicentros donde nacieron los patrones que a煤n hacen vibrar al mundo.</p>
      </div>

      <div id="map"></div>
    </section>
  </main>

  <footer class="page-footer">
    <p>Mapa interactivo elaborado para el proyecto de historia musical.</p>
  </footer>

    <script>
      (function () {
        function clamp(value, min, max) {
          return Math.min(Math.max(value, min), max);
        }

        function syncTrack(track) {
          var svg = track.querySelector('.timeline-curve');
          if (!svg) return;
          var path = svg.querySelector('path');
          if (!path) return;

          var viewBox = svg.viewBox.baseVal;
          var pathLength = path.getTotalLength();
          var trackRect = track.getBoundingClientRect();
          var svgRect = svg.getBoundingClientRect();
          var offsetX = svgRect.left - trackRect.left;
          var offsetY = svgRect.top - trackRect.top;
          var ratioX = svgRect.width / viewBox.width;
          var ratioY = svgRect.height / viewBox.height;

          track.querySelectorAll('.timeline-event').forEach(function (eventEl) {
            var progressAttr = parseFloat(eventEl.dataset.progress);
            var cssPos = eventEl.style.getPropertyValue('--pos').replace('%', '').trim();
            var fallbackProgress = cssPos ? parseFloat(cssPos) / 100 : 0;
            var progress = clamp(isNaN(progressAttr) ? fallbackProgress : progressAttr, 0, 1);
            var point = path.getPointAtLength(pathLength * progress);

            var relativeX = offsetX + point.x * ratioX;
            var relativeY = offsetY + point.y * ratioY;
            var xPercent = (relativeX / trackRect.width) * 100;
            var yPercent = (relativeY / trackRect.height) * 100;

            eventEl.style.setProperty('--pos', xPercent + '%');
            eventEl.style.setProperty('--node-anchor', yPercent + '%');
          });
        }

        function syncAll() {
          document.querySelectorAll('.timeline-track').forEach(syncTrack);
        }

        function bindWheelScroll() {
          var timelines = document.querySelectorAll('.timeline');
          timelines.forEach(function (timeline) {
            if (timeline.dataset.wheelBound === 'true') return;
            timeline.dataset.wheelBound = 'true';
            timeline.addEventListener(
              'wheel',
              function (evt) {
                if (evt.ctrlKey) return;
                var delta = Math.abs(evt.deltaY) > Math.abs(evt.deltaX) ? evt.deltaY : evt.deltaX;
                if (delta === 0) return;

                var prev = timeline.scrollLeft;
                var maxScroll = timeline.scrollWidth - timeline.clientWidth;
                if (maxScroll <= 0) return;

                var next = Math.min(Math.max(prev + delta, 0), maxScroll);
                timeline.scrollLeft = next;

                if (next !== prev) {
                  evt.preventDefault();
                }
              },
              { passive: false }
            );
          });
        }

        function init() {
          syncAll();
          bindWheelScroll();
        }

        window.addEventListener('resize', syncAll);
        window.addEventListener('load', init);
        init();
      })();
    </script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    var map = L.map('map').setView([15, 0], 2);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 18,
      attribution: '漏 OpenStreetMap, 漏 Carto'
    }).addTo(map);

    var puntos = [
      { coords: [15, -1], texto: "frica Occidental<br>Djembe, sabar, tambores parlantes." },
      { coords: [28.6, 77.2], texto: "India<br>Tabla, mridangam, ghatam." },
      { coords: [36, 138], texto: "Jap贸n<br>Taiko: rituales, teatro, festivales." },
      { coords: [30, 31], texto: "Egipto / Pr贸ximo Oriente<br>Percusi贸n ritual ancestral." },
      { coords: [50, -3], texto: "Reino Unido<br>Evelyn Glennie y la percusi贸n cl谩sica moderna." },
      { coords: [43.7, -79.4], texto: "Canad谩<br>NEXUS: pioneros de la percusi贸n contempor谩nea." },
      { coords: [40.4, -3.7], texto: "Europa<br>Timbales, caja, bombo y platillos orquestales." },
      { coords: [19.4, -99.1], texto: "M茅xico / Caribe<br>Congas, bong贸s, timbales." },
      { coords: [-12, -77], texto: "Per煤<br>Caj贸n afroperuano." },
      { coords: [-23, -43], texto: "Brasil<br>Samba y tradiciones afrobrasile帽as." },
      { coords: [29.8, -95.3], texto: "EE. UU.<br>Bater铆a moderna: jazz, rock, funk." }
    ];

    puntos.forEach(function(p) {
      L.marker(p.coords).addTo(map).bindPopup(p.texto);
    });
  </script>
</body>
</html>
